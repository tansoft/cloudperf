
# 概述

这是一个提供各个城市、运营商之间网络质量查询的网站CloudPerf，系统中每个网络质量信息都是源到目标的延时信息，源和目标都可以用cityid来表示，一个cityid由ISO3166规定的国家代码，对应城市和对应运营商id组成。在系统中，主要观察源和目标的多个cityid之间的数据，并进行统计分析。

src/web 是这个项目的根目录，项目代码都生成在这里面，使用react框架mui.com上的material-ui制作，地图组件使用OpenStreetMap。

网站有以下核心功能：

* 网站由后端接口 /api/* 和前端页面组成，后端测试接口由 src/services/api.js 实现，通过npm run dev进行调用测试。
* 访问网站首页 / 时，会通过cookie判断是否已经登录，没有登录时跳转到登录页面 /login ，使用账号 admin / admin 登录之后，会进入主页 /dashboard
* 主体页面由标题栏、左侧的菜单栏和右侧的具体页面组成。
* 其中标题栏是固定的，中间显示系统运行状态信息，信息每隔10秒请求 /api/status 接口返回最新信息显示，右侧通过cookie显示登录账号 admin 的名字，并提供 退出登录 按钮。
* 左侧菜单栏包括每个页面的导航菜单，点击后右侧会打开对应页面，包括以下页面：
 * IP查询 /ipsearch：页面中有ip输入框，填入参数ip后，请求后端接口 /api/ipinfo?ip=2.3.4.5，返回信息包括IP所属asn号码，所属国家，所属省，asn类型，ip段起始和结束范围，cityid，经度，纬度等。
 * 运营商查询 /asnsearch：页面中有运营商输入框，填入参数asn后，请求后端接口 /api/asninfo?filter=Amazon，返回多个匹配信息列表，每个信息包括：asn号码，所属国家，所属省，asn类型，ip段起始和结束范围，cityid，经度，纬度等，列表第一栏增加复选框，用户可以多选结果后，起一个名字，并保存到一个组合中，提交 POST /api/cityset。
 * 网络质量查询 /search：页面通过源和目标多个cityids参数进行查询，如果参数齐全，则请求后端接口 /api/performance?src=123,432,454&dist=567,342,33，返回信息包括：四个信息框：样本数，平均延迟，中位数延迟，P70；折线图：过去7天内平均延迟的采样数据；柱状图：源id分类汇总asn后的延迟数据；柱状图：源id分类汇总城市后的延迟数据；地图：源和目标点的位置分布。
 * 网络质量查询 页面中，可以通过两种方式选择源cityids，一是通过选择预置的组合，组合由 /api/cityset 接口提供，二是通过国家，城市，运营商选择框选择，其中下拉选择框国家通过 /api/country 提供，国家选择框可以直接下拉选择，或输入关键字进行过滤，在国家选择框选择完毕后，会更新城市选择框数据，通过 /api/city?country=xx 提供，城市选择框可以直接下拉选择，或输入关键字进行过滤，在城市选择框选择完毕后，会更新运营商选择框数据，通过 /api/asn?country=xx&city=yy 提供，asn数据中包含asn名称和cityid，默认是全选状态，可以通过反选，剔除不需要的运营商，最后得出源cityids。目标cityids，通过国家，城市，运营商选择框选择。
 * 组合管理 /cityset：列出所有cityids的组合，可以进行添加，编辑，删除等。
 * 使用npm run dev进行测试，npm run build 将会把发布静态文件，保存到 lambda/app/public目录中
  